<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="打怪升级，游戏人生"><title>常见模块化规范研究记录 | SioCheung</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + '05229ec683dcdbf3f2336800f1e4a337';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
  </script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">常见模块化规范研究记录</h1><a id="logo" href="/."><span class="defualt">Sio</span><span class="vi-color">Cheung</span></a><p class="description">君子求诸己</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">常见模块化规范研究记录</h1><div class="post-meta">Sep 29, 2019</div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#ES-Module-重点"><span class="toc-number">1.</span> <span class="toc-text">ES Module(重点)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#与CommonJs的引入关系"><span class="toc-number">1.1.</span> <span class="toc-text">与CommonJs的引入关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在Node环境中支持情况"><span class="toc-number">1.2.</span> <span class="toc-text">在Node环境中支持情况</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在浏览器环境支持情况"><span class="toc-number">1.3.</span> <span class="toc-text">在浏览器环境支持情况</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ES-Module循环引用的问题"><span class="toc-number">1.4.</span> <span class="toc-text">ES Module循环引用的问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CommonJs-重点"><span class="toc-number">2.</span> <span class="toc-text">CommonJs (重点)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#exports-vs-module-exports"><span class="toc-number">2.1.</span> <span class="toc-text">exports vs module.exports</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#commonJS循环引用的问题"><span class="toc-number">2.2.</span> <span class="toc-text">commonJS循环引用的问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AMD"><span class="toc-number">3.</span> <span class="toc-text">AMD</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CMD"><span class="toc-number">4.</span> <span class="toc-text">CMD</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UMD"><span class="toc-number">5.</span> <span class="toc-text">UMD</span></a></li></ol></div></div><div class="post-content"><p>虽然对模块化这些规范很熟悉，因为频繁遇到所以还是重新梳理一遍，有疑问的地方做个实践论证。重点研究分析EsModule和cjs，cmd、amd、umd则会只研究基本概念和常用方案。<br><a id="more"></a></p>
<h2 id="ES-Module-重点"><a href="#ES-Module-重点" class="headerlink" title="ES Module(重点)"></a>ES Module(重点)</h2><ul>
<li>旨在成为浏览器和服务器通用的模块化解决方案，模块功能主要由两个命令构成：<code>export</code>和<code>import</code>。</li>
<li><code>import</code>命令会被 JavaScript 引擎静态分析。当遇到模块加载命令<code>import</code>，会生成一个只读引用（ES6的模块不是对象而是值的引用），等运行时，再根据这个只读引用去被加载的模块取值。所以编译时候就引入了模块代码，而非代码运行时引入，所以无法实现执行条件加载或者字符串拼接路径之类的，这种加载称为<strong>编译时加载</strong>。</li>
<li>ESM的模块输出的是值的引用而非拷贝，所以内部改变变量会改变export出的值。</li>
</ul>
<h3 id="与CommonJs的引入关系"><a href="#与CommonJs的引入关系" class="headerlink" title="与CommonJs的引入关系"></a>与CommonJs的引入关系</h3><p><code>ES Module</code> import也可以引入<code>Commonjs</code>的模块，模块得使用Commonjs规范编写，后缀名为<code>.cjs</code>或者模块自身的package.json中设置</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"type": "commonJs”</span><br></pre></td></tr></table></figure>
<h3 id="在Node环境中支持情况"><a href="#在Node环境中支持情况" class="headerlink" title="在Node环境中支持情况"></a>在Node环境中支持情况</h3><p>Node版本 &gt;=13.2.0 直接支持 </p>
<p>Node版本 &lt;13.2.0 如12的版本添加<code>--experimental-module</code> ，低于12版本的则不支持</p>
<p>Node环境中的加载支持都需要用<code>.mjs</code>扩展后缀或者在<code>package.json</code>中设置</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"type": "module"</span><br></pre></td></tr></table></figure>
<h3 id="在浏览器环境支持情况"><a href="#在浏览器环境支持情况" class="headerlink" title="在浏览器环境支持情况"></a>在浏览器环境支持情况</h3><ul>
<li>安全策略更严格，<strong>非同域脚本</strong>的加载受 CORS 策略限制</li>
<li>服务器端提供 ES Module 资源时，必须返回有效的属于 JavaScript 类型的 Content-Type 头如<code>text/javascript</code></li>
</ul>
<p>目前主流浏览器都已经对于ES Module支持。 给 <code>script</code> 标签添加 <code>type=module</code> 属性，就可以让浏览器以 ES Module 的方式加载脚本。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">module</span> <span class="attr">src</span>=<span class="string">'x'</span> /&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="handlebars"><span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">module</span>&gt;</span><span class="undefined"></span></span></span></span><br><span class="line"><span class="actionscript"><span class="comment">// do something</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>针对非内联script的<code>defer</code>和<code>async</code>，无论在什么位置都不会阻塞HTML的解析，它们的区别是<code>async</code>是下载完立刻执行不会按照脚本在页面上的顺序，<code>defer</code>是按脚本的顺序执行。内联script的<code>defer</code>和<code>async</code>不生效。</p>
<p> module的script下载和执行同样不阻塞HTML解析器，无论内联还是外联，模块之间是按照顺序执行的。给 script 标签显式指定 <code>async</code>  <code>defer</code> 行为属性。但添加<code>defer</code>并没有意义。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">module</span> <span class="attr">src</span>=<span class="string">'x'</span> <span class="attr">async</span> &gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">module</span> <span class="attr">async</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript"><span class="comment">// do something</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>远程 script 根据 URL 作为判断唯一性的 Key，决定进行一次还是多次执行。URL 是<strong>同一路径下</strong>的模块多次加载只会进行一次执行，<code>div#counter</code>的<code>data-count</code>属性值是<code>1</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.js</span></span><br><span class="line"><span class="keyword">const</span> el = <span class="built_in">document</span>.getElementById(<span class="string">'counter'</span>);</span><br><span class="line"><span class="keyword">const</span> countNum = <span class="built_in">parseInt</span>(el.dataset.count.trim() || <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line">el.dataset.count = countNum++;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">module</span> <span class="attr">src</span>=<span class="string">'./a.js'</span> <span class="attr">async</span> &gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">module</span> <span class="attr">src</span>=<span class="string">'./a.js'</span> <span class="attr">async</span> &gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">module</span> <span class="attr">src</span>=<span class="string">'./a.js'</span> <span class="attr">async</span> &gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="ES-Module循环引用的问题"><a href="#ES-Module循环引用的问题" class="headerlink" title="ES Module循环引用的问题"></a>ES Module循环引用的问题</h3><p>ES6模块不会缓存运行结果，而是动态地去被加载的模块取值，以及变量总是绑定其所在的模块。<strong>ES6根本不会关心是否发生了”循环加载”，只是生成一个指向被加载模块的引用，需要开发者自己保证，真正取值的时候能够取到值。</strong></p>
<p><mark>注意!!</mark> ES Module循环引用一定要有<strong>跳出机制</strong>，不然就会堆栈溢出，像下面这样。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">RangeError: Maximum call stack size exceeded</span><br><span class="line">    at afn (file:///Users/aszero/sourcecode/lab/modules/a.mjs:3:20)</span><br><span class="line">    at bfn (file:///Users/aszero/sourcecode/lab/modules/b.mjs:4:3)</span><br><span class="line">    at afn (file:///Users/aszero/sourcecode/lab/modules/a.mjs:4:3)</span><br><span class="line">    at bfn (file:///Users/aszero/sourcecode/lab/modules/b.mjs:4:3)</span><br><span class="line">    at afn (file:///Users/aszero/sourcecode/lab/modules/a.mjs:4:3)</span><br><span class="line">    at bfn (file:///Users/aszero/sourcecode/lab/modules/b.mjs:4:3)</span><br><span class="line">    at afn (file:///Users/aszero/sourcecode/lab/modules/a.mjs:4:3)</span><br><span class="line">    at bfn (file:///Users/aszero/sourcecode/lab/modules/b.mjs:4:3)</span><br><span class="line">    at afn (file:///Users/aszero/sourcecode/lab/modules/a.mjs:4:3)</span><br><span class="line">    at bfn (file:///Users/aszero/sourcecode/lab/modules/b.mjs:4:3)</span><br></pre></td></tr></table></figure>
<p>举个循环应用的例子</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.mjs</span></span><br><span class="line"><span class="keyword">import</span> &#123; bfn &#125; <span class="keyword">from</span> <span class="string">'./b.mjs'</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">afn</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'afn执行，开始调用bfn'</span>)</span><br><span class="line">  bfn()</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'afn执行完毕'</span>)</span><br><span class="line">&#125;</span><br><span class="line">afn()</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// b.mjs</span></span><br><span class="line"><span class="keyword">import</span> &#123; afn &#125; <span class="keyword">from</span> <span class="string">'./a.mjs'</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">bfn</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> randomNum = <span class="built_in">Math</span>.random()</span><br><span class="line">  <span class="built_in">console</span>.log(randomNum &gt; <span class="number">0.5</span> ? <span class="string">'bfn进入条件'</span> : <span class="string">'bfn返回空'</span>)</span><br><span class="line">  <span class="keyword">if</span> (randomNum &gt; <span class="number">0.5</span>) &#123; <span class="comment">// 随机跳出机制</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'bfn执行，开始调用afn'</span>)</span><br><span class="line">    afn()</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'bfn执行完毕'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的随机数就是循环引用的跳出机制</p>
<p>执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> node a.mjs</span></span><br></pre></td></tr></table></figure>
<p>打印的结果有很多种可能性，因为是根据随机数的条件随机退出的，我们取一组数据看一下运行流程</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">afn执行，开始调用bfn <span class="comment">// a</span></span><br><span class="line">bfn进入条件 <span class="comment">// a - b</span></span><br><span class="line">bfn执行，开始调用afn <span class="comment">// a - b</span></span><br><span class="line">afn执行，开始调用bfn <span class="comment">// a - b - a</span></span><br><span class="line">bfn返回空 <span class="comment">// a - b - a - b 退出机制返回空</span></span><br><span class="line">afn执行完毕 <span class="comment">// a - b - a</span></span><br><span class="line">bfn执行完毕 <span class="comment">// a - b</span></span><br><span class="line">afn执行完毕 <span class="comment">// a</span></span><br></pre></td></tr></table></figure>
<p>上面可以看出ES module执行的时候是忽略<code>import</code>加载，<strong>模块加载命令import时不会去执行模块</strong>，只是生成一个指向被加载模块的引用，需要开发者保证真正取值时能够取到值，只要引用是存在的，代码就能执行。</p>
<p>上面的字母表示了执行的流程，分析如下，首先执行<code>afn</code> (<strong>链路a</strong>)，调用bfn，进入<code>bfn</code>(<strong>链路a-b</strong>)如果满足条件进入循环引用调用<code>afn</code>，此时回到<code>afn</code>(<strong>链路a-b-a</strong>)再调用<code>bfn</code>，进入<code>bfn</code>(<strong>链路a-b-a-b</strong>)不满足进入循环引用的条件退出循环，返回空，那么上一层<code>afn</code>(<strong>链路a-b-a</strong>)继续执行完毕，再上一层引用这个<code>afn</code>的bfn(<strong>链路a-b</strong>)也执行完毕，同时引用这个<code>bfn</code>的<code>afn</code>(<strong>链路a</strong>)也执行完毕。</p>
<h2 id="CommonJs-重点"><a href="#CommonJs-重点" class="headerlink" title="CommonJs (重点)"></a>CommonJs (重点)</h2><ul>
<li><strong>同步加载机制，常见于NodeJs</strong>。在Node环境使用<code>module</code>、<code>exports</code>、<code>require</code>、 <code>filename</code>、 <code>dirname</code>提供模块化支持。</li>
<li>CommonJS 的模块<strong>输出的是值的浅拷贝</strong>，内部改变变量不会改变exports出的值。模块就是对象（即<code>module.exports</code>属性），等到运行时才把模块挂载在exports之上，加载模块其实就是查找对象属性，这种加载称为<strong>运行时加载</strong>。node中模块导入require是一个内置的函数，因此只有在运行后我们才可以得知模块导出内容，无法做静态分析。</li>
<li>同步加载，代码在本地，加载时间基本等于硬盘读取时间。浏览器环境不支持CommonJS。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">exports, require, module, __filename, __dirname</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// code</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="exports-vs-module-exports"><a href="#exports-vs-module-exports" class="headerlink" title="exports vs module.exports"></a>exports vs module.exports</h3><ul>
<li>module.exports 默认值为{}</li>
<li>exports 是 module.exports 的引用</li>
<li>exports 默认指向 module.exports 的内存空间</li>
<li>require() 返回的是 module.exports 而不是 exports</li>
<li>若对 exports 重新赋值，则断开了 exports 对 module.exports 的指向</li>
</ul>
<h3 id="commonJS循环引用的问题"><a href="#commonJS循环引用的问题" class="headerlink" title="commonJS循环引用的问题"></a>commonJS循环引用的问题</h3><p>CommonJS模块的重要特性是加载时执行，即脚本代码在<code>require</code>的时候，就会全部执行。<strong>CommonJS的做法是，一旦出现某个模块被”循环加载”，就只输出已经执行的部分，还未执行的部分不会输出。</strong> 下面我做了个图方便理解，图中序号是执行顺序。</p>
<blockquote>
<p>例如 a.js引用b.js，b.js中也引用了a.js，那么a.js代码在执行到引用b.js的时候<strong>require(b.js)</strong>(图中流程2节点)，停止执行下面的代码去加载b.js并执行，在b.js中执行到又引用a.js的时候<strong>require(a.js)</strong>(图中流程4节点)，这时候a.js已经执行了多少输出b.js就引入多少(图中流程1节点输出)，b.js保持继续执行直到执行完毕(图中流程5节点)，这时候就回到a.js(图中流程6节点)加载执行b.js中断执行的地方继续执行，这时候也可以用b.js的输出值(图中流程5节点输出)。</p>
</blockquote>
<p><img src="https://aszero.oss-cn-shanghai.aliyuncs.com/aszero/esmod-circle_cjs.jpg" width="100%"></p>
<h2 id="AMD"><a href="#AMD" class="headerlink" title="AMD"></a>AMD</h2><ul>
<li><strong>异步加载机制</strong>，模块的加载不影响后面语句的执行。依赖部分会在执行完成之后的回调中定义。</li>
<li>AMD举例<strong>require.js</strong>实现AMD规范的模块化：用<code>require.config()</code>指定引用路径等，用<code>define()</code>定义模块，用<code>require()</code>加载模块。</li>
<li>AMD/CMD是CommonJS在浏览器端的解决方案。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 网页中引入require.js及main.js</span></span><br><span class="line">&lt;script src=<span class="string">"js/require.js"</span> data-main=<span class="string">"js/main"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// config()指定各模块路径和引用名</span></span><br><span class="line"><span class="built_in">require</span>.config(&#123;</span><br><span class="line">  baseUrl: <span class="string">"js/lib"</span>,</span><br><span class="line">  paths: &#123;</span><br><span class="line">    <span class="string">"jquery"</span>: <span class="string">"jquery.min"</span>,  <span class="comment">//实际路径为js/lib/jquery.min.js</span></span><br><span class="line">    <span class="string">"underscore"</span>: <span class="string">"underscore.min"</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 引用模块</span></span><br><span class="line"><span class="built_in">require</span>([<span class="string">"jquery"</span>,<span class="string">"underscore"</span>],<span class="function"><span class="keyword">function</span>(<span class="params">$,_</span>)</span>&#123;</span><br><span class="line">  <span class="comment">// some code here</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 定义的模块本身如果也需要依赖</span></span><br><span class="line">define([<span class="string">'underscore'</span>],<span class="function"><span class="keyword">function</span>(<span class="params">_</span>)</span>&#123;</span><br><span class="line">   <span class="comment">// some code here</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h2><p>CMD是另一种js模块化方案，它与AMD很类似，不同点在于：AMD 推崇依赖前置、提前执行，CMD推崇<strong>依赖就近、延迟执行</strong>。CMD举例<strong>sea.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** AMD写法 **/</span></span><br><span class="line">define([<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>, <span class="string">"e"</span>, <span class="string">"f"</span>], <span class="function"><span class="keyword">function</span>(<span class="params">a, b, c, d, e, f</span>) </span>&#123; </span><br><span class="line">     <span class="comment">// 等于在最前面声明并初始化了要用到的所有模块</span></span><br><span class="line">    a.doSomething();</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="comment">// 即便没用到某个模块 b，但 b 还是提前执行了</span></span><br><span class="line">        b.doSomething()</span><br><span class="line">    &#125; </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/** CMD写法 **/</span></span><br><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require, exports, module</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">'./a'</span>); <span class="comment">//在需要时申明</span></span><br><span class="line">    a.doSomething();</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> b = <span class="built_in">require</span>(<span class="string">'./b'</span>);</span><br><span class="line">        b.doSomething();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/** sea.js **/</span></span><br><span class="line"><span class="comment">// 定义模块 math.js</span></span><br><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require, exports, module</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $ = <span class="built_in">require</span>(<span class="string">'jquery.js'</span>);</span><br><span class="line">    <span class="keyword">var</span> add = <span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a+b;</span><br><span class="line">    &#125;</span><br><span class="line">    exports.add = add;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 加载模块</span></span><br><span class="line">seajs.use([<span class="string">'math.js'</span>], <span class="function"><span class="keyword">function</span>(<span class="params">math</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> sum = math.add(<span class="number">1</span>+<span class="number">2</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="UMD"><a href="#UMD" class="headerlink" title="UMD"></a>UMD</h2><p>是AMD和CommonJS的糅合，跨平台的解决方案。</p>
<p><code>AMD</code> 模块以浏览器第一的原则发展，异步加载模块。 <code>CommonJS</code> 模块以服务器第一原则发展，选择同步加载。它的模块无需包装(unwrapped modules)。 这迫使人们又想出另一个更通用的模式 <code>UMD</code>（Universal Module Definition)，实现跨平台的解决方案。<code>UMD</code> 先判断支持 <code>Node.js</code> 的模块（<code>exports</code>）是否存在，存在则使用 <code>Node.js</code> 模块模式。再判断是否支持 <code>AMD</code>（<code>define</code> 是否存在），存在则使用 <code>AMD</code> 方式加载模块。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">window, factory</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> exports === <span class="string">'object'</span>) &#123;</span><br><span class="line">     </span><br><span class="line">        <span class="built_in">module</span>.exports = factory();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">'function'</span> &amp;&amp; define.amd) &#123;</span><br><span class="line">     </span><br><span class="line">        define(factory);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     </span><br><span class="line">        <span class="built_in">window</span>.eventUtil = factory();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//module ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>原创内容，欢迎交流转载请注明出处</p>
</blockquote>
</div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>theo</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="/posts/e7485c24/">https://joacycode.github.io/posts/e7485c24/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>theoCheung@China</li></ul></div><br><div class="tags"></div><div class="post-nav"><a class="pre" href="/posts/6b76c6f6/">shell编程来实现一些自动化-基础篇</a><a class="next" href="/posts/7b16fe01/">你不知道的rollup</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget widget-info"><div class="widget-info"><a style="text-align:center"><img class="widget-info-photo" src="https://aszero.oss-cn-shanghai.aliyuncs.com/imgs/fangao_495x606.jpg" style="width:80px;height:80px;border-radius: 100%;"></a><p class="myname">SioCheung</p><p class="slogan">Zero to Hero</p></div></div><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/posts/a0e43f83/">DSL介绍和使用</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/15ddfa03/">你不知道的AST</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/97b701ae/">你不知道的babel</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/e87e7952/">那一年前端招人的部分笔试题</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/6b76c6f6/">shell编程来实现一些自动化-基础篇</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/e7485c24/">常见模块化规范研究记录</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/7b16fe01/">你不知道的rollup</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/ad3abf2b/">浏览器标签之间的通信</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/30ba4d06/">你不知道的yarn</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/5ece973c/">我对于同步异步和阻塞非阻塞理解</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/categories/">categories</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/dotjs/">dotjs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/h5/">h5</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/node/">node</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/shell/">shell</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tool/">tool</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ts/">ts</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/">vue</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/webpack/">webpack</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/windows/">windows</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具/">工具</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/joacycode" title="github.com/joacycode" target="_blank">github.com/joacycode</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2022 <a href="/." rel="nofollow">SioCheung.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>