<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="打怪升级，游戏人生"><title>js的this指向实践问题记录 | SioCheung</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + '05229ec683dcdbf3f2336800f1e4a337';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
  </script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">js的this指向实践问题记录</h1><a id="logo" href="/."><span class="defualt">Sio</span><span class="vi-color">Cheung</span></a><p class="description">君子求诸己</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">js的this指向实践问题记录</h1><div class="post-meta">Feb 7, 2018<span> | </span><span class="category"><a href="/categories/js/">js</a></span></div><div class="post-content"><h4 id="遇到的this问题的翻车事故"><a href="#遇到的this问题的翻车事故" class="headerlink" title="遇到的this问题的翻车事故"></a>遇到的this问题的翻车事故</h4><p><code>this</code>对于当时刚接触js的人来说幽灵一般的存在，就是老司机也不免有大意翻车的时候，印象中很多前端面试的基础部分考察<code>prototype</code>和<code>this</code>是必不可少的。<br>前几天改一个bug改出<code>this</code>的问题，大意翻车，虽然很快就解决了，但还是警醒下自己，温习梳理以免再出错。<br>问题类似下面的代码块，对象外提取公共模块导入，对象内部方法和属性通过对象传参<code>params</code>的方式进入<code>setTime</code>方法执行业务逻辑。<br><a id="more"></a><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setTime</span>(<span class="params">params</span>)</span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span> <span class="title">fn4</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    params.keyFn2();</span><br><span class="line">  &#125;,<span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obja=&#123;</span><br><span class="line">  valname: <span class="string">'xzhang'</span>,</span><br><span class="line">  fn1()&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.valname + <span class="string">' did fn1'</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  fn2()&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.fn1()+<span class="string">' and did fn2'</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  fn3()&#123;</span><br><span class="line">    setTime(&#123;</span><br><span class="line">        keyFn2: <span class="keyword">this</span>.fn2</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">obja.fn3();</span><br></pre></td></tr></table></figure><br>但是执行后报错，<code>fn2</code>方法是执行过后，但是里面却找不到<code>fn1</code>这个方法，看到这个bug一脸懵逼。<br>老司机也会翻车好像说的就是我，当时就想当然的的认为(以下是错误思考过程)<code>fn2</code>通过<code>this.fn2</code>传参进入，<code>this</code>也会传进去，所以<code>this.fn1</code>的<code>this</code>理所应当的指向<code>obja</code>,所有的方法都会找到自己的对象宿主去执行（错误思考过程结束），还是因为懒，思想都不愿意往前多想一步。<br>遇到问题总是要解决的。<br>先思考后动手是我的习惯，这里报错很显然是<code>this</code>指向出现了问题，找到这个问题根源，也就不难发现根源在哪里、怎么去解决了。<br>so…<br>万年不变的<code>console</code>调式大法<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setTime</span>(<span class="params">params</span>)</span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span> <span class="title">fn4</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>, <span class="string">'fn3-fn4'</span>);</span><br><span class="line">    params.keyFn2();</span><br><span class="line">  &#125;,<span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obja=&#123;</span><br><span class="line">  valname: <span class="string">'xzhang'</span>,</span><br><span class="line">  fn1()&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'fn1'</span>,<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.valname + <span class="string">' did fn1'</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  fn2()&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'fn2'</span>,<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.fn1()+<span class="string">' and did fn2'</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  fn3()&#123;</span><br><span class="line">    setTime(&#123;</span><br><span class="line">        keyFn2: <span class="keyword">this</span>.fn2</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">obja.fn3();</span><br></pre></td></tr></table></figure><br>结果如下：<br><img src="https://aszero.oss-cn-shanghai.aliyuncs.com/aszero/this-a.jpg" width="100%"><br>果不其然<code>fn2</code>中的<code>this</code>指向出现了问题，所以找不到<code>fn1</code>方法很正常。错误的<code>this</code>指向了一个对象，既不是<code>windows</code>也不是<code>obja</code>，而是<code>{keyFn2: f}</code>，看着好眼熟，嗯？这个对象不就是我们<code>setTime</code>传进去的对象参数<code>params</code>么?<br>再看看<code>fn4</code>里的调用方法<code>params.keyFn2()</code>,所以一切都很明了了：<code>setTime</code>里的<code>keyFn2</code>方法能够通过<code>this.fn2</code>传参进去，方法能够得到执行，但是<code>fn2</code>方法里面还有<code>this</code>，这个<code>this</code>的指向就有问题了，它指向的是调用这个方法的<code>params</code>也就是<code>{keyFn2: f}</code>，这个对象里根本没有<code>fn1</code>方法！<br>进一步<code>fn1</code>就算得到执行，方法里面的依然有<code>this</code>的问题，所以也得进行手动指向。<br><mark>如果想得到正确的结果必须明确<code>this</code>的指向。</mark><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setTime</span>(<span class="params">params</span>)</span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span> <span class="title">fn4</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(params.keyFn2(params.self));</span><br><span class="line">  &#125;,<span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obja=&#123;</span><br><span class="line">  valname: <span class="string">'xzhang'</span>,</span><br><span class="line">  fn1(s)&#123;</span><br><span class="line">    <span class="keyword">const</span> self = s? s : <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">return</span> self.valname + <span class="string">' did fn1'</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  fn2(s)&#123;</span><br><span class="line">    <span class="keyword">const</span> self = s? s : <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">return</span> self.fn1(s)+<span class="string">' and did fn2'</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  fn3()&#123;</span><br><span class="line">    setTime(&#123;</span><br><span class="line">        keyFn2: <span class="keyword">this</span>.fn2,</span><br><span class="line">        self: <span class="keyword">this</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">obja.fn3();</span><br></pre></td></tr></table></figure><br><img src="https://aszero.oss-cn-shanghai.aliyuncs.com/aszero/this-c.jpg" width="100%"><br>大功告成，到这里bug就算修复完毕了，但是思考一个问题，我们工作就是为了码代码，修复bug的么？ <mark>这个是不是最佳的处理方式呢？</mark></p>
<p>上面的代码没有提取公共模块之前是下面这么写的，一点问题都没有，<code>this</code>指向正常，除了通过<code>_this</code>纠正了<code>es5</code>的指向，其他并不需要操心。<br>但是需要使用额外的外界方法，并且方法中涉及<code>this</code>指向的问题就需要小心了。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> objb=&#123;</span><br><span class="line">  valname: <span class="string">'xzhang'</span>,</span><br><span class="line">  fn1()&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'fn1'</span>,<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.valname + <span class="string">' did fn1'</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  fn2()&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'fn2'</span>,<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.fn1()+<span class="string">' and did fn2'</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  fn3()&#123;</span><br><span class="line">    <span class="keyword">const</span> _this = <span class="keyword">this</span>;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span> <span class="title">fn4</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"fn3"</span>, <span class="keyword">this</span>, _this);</span><br><span class="line">      <span class="built_in">console</span>.log(_this.fn2());</span><br><span class="line">    &#125;,<span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">objb.fn3();</span><br></pre></td></tr></table></figure><br><img src="https://aszero.oss-cn-shanghai.aliyuncs.com/aszero/this-b.jpg" width="100%"></p>
<h4 id="this指向总结"><a href="#this指向总结" class="headerlink" title="this指向总结"></a>this指向总结</h4><p>老司机就不用往下看了，自己写出来也算是一种加深印象，就像小学时候写错一个字拿两杆笔写罚抄一百遍一样，为了不再犯错。<br>*注：以下都为Browser环境</p>
<h5 id="普通function里的this"><a href="#普通function里的this" class="headerlink" title="普通function里的this"></a>普通function里的this</h5><p>此时<code>this</code>指向全局<code>windows</code>,凡是挂载到windows上的变量方法此时都可以通过<code>this</code>调用。箭头函数也是如此。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> glb = <span class="string">'windows'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testThis</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>,<span class="keyword">this</span>.glb);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> arrowTestThis = <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>,<span class="keyword">this</span>.glb);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><img src="https://aszero.oss-cn-shanghai.aliyuncs.com/aszero/this-d.jpg" width="100%"><br>不管函数嵌套多少层，this返回的都是<code>windows</code><br><img src="https://aszero.oss-cn-shanghai.aliyuncs.com/aszero/this-e.jpg" width="100%"></p>
<h5 id="new调用function里的this"><a href="#new调用function里的this" class="headerlink" title="new调用function里的this"></a>new调用function里的this</h5><p>此时的<code>this</code>指向new出来的实例。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">newfun</span>(<span class="params">params</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> <span class="keyword">new</span>.target == <span class="string">'undefined'</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'constructor must be called with new'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'newfun里的this指向：'</span>,<span class="keyword">this</span>);</span><br><span class="line">  <span class="keyword">this</span>.name = params.name;</span><br><span class="line">  <span class="keyword">this</span>.takebus = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name + <span class="string">' takes bus'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> newObj = <span class="keyword">new</span> newfun(&#123;<span class="attr">name</span>:<span class="string">'xzhang'</span>&#125;);</span><br></pre></td></tr></table></figure><br><img src="https://aszero.oss-cn-shanghai.aliyuncs.com/aszero/this-f.jpg" width="100%"><br>可以看到打印出来的<code>this</code>指向了new出来的实例，这里的<code>this</code>就暂时可以想象成<code>newObj</code>。</p>
<h5 id="prototype里的this"><a href="#prototype里的this" class="headerlink" title="prototype里的this"></a>prototype里的this</h5><p>Constructor的prototype属性上挂载的属性和方法都可以被实例所<em>共享继承</em>使用，避免了每次生成实例都需要累计占用内存的情况。<br>Constructor里的<code>this</code>和prototype的挂载方法里的<code>this</code>在Constructor实例化后都将指向当前的实例对象，所以挂载在Constructor里的<code>this</code>上的方法属性以及挂载在prototype上的属性和方法，在Constructor里和prototype上挂载的方法里都是可以通过<code>this</code>调用（实例都可以访问的到）。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Construc</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line">Construc.prototype.age = <span class="string">'秘密'</span>;</span><br><span class="line">Construc.prototype.introduction = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'prototype里的this:'</span>,<span class="keyword">this</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'prototype:'</span>, Construc.prototype);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">' age is '</span> + <span class="keyword">this</span>.age);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><img src="https://aszero.oss-cn-shanghai.aliyuncs.com/aszero/this-j.jpg" width="100%"><br>在prototype里打印当前的<code>this</code>以及<code>Construc.prototype</code>。<br>prototype1里的<code>this</code>指向实例，例如<code>construc</code>。<br><code>Construc.prototype</code>为当前的prototype对象，里面包含constructor<code>Construc</code>。</p>
<p>上面的代码块可以理解为下面的这种，只是帮助理解。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Construc</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.age = <span class="string">'秘密'</span>;</span><br><span class="line">  <span class="keyword">this</span>.introduction = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">' age is '</span> + <span class="keyword">this</span>.age);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>prototype上的属性方法完全被’代理’到了当前它的Constructor上，它的所有属性和方法都是Constructor的属性和方法，<code>Construc</code>里的this指向实例，<code>Construc.prototype</code>里的<code>this</code>自然也指向实例。</p>
<h5 id="Object里的this"><a href="#Object里的this" class="headerlink" title="Object里的this"></a>Object里的this</h5><p>这里的<code>Object</code>指的是字面量的，此时对象字面量里的<code>this</code>指向<code>windows</code>（对象属性中调用<code>this</code>）或者此<code>object</code>（对象方法函数中调用<code>this</code>）本身。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> testOBJ =&#123;</span><br><span class="line">  name:<span class="string">'xzhang'</span>,</span><br><span class="line">  age:<span class="number">20</span>,</span><br><span class="line">  testThis: <span class="keyword">this</span>,</span><br><span class="line">  dosome:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><img src="https://aszero.oss-cn-shanghai.aliyuncs.com/aszero/this-h.jpg" width="100%"></p>
<h5 id="event里的this"><a href="#event里的this" class="headerlink" title="event里的this"></a>event里的this</h5><p>此时的<code>this</code>指向事件绑定的dom节点，但是可以通过<code>bind</code>改变<code>this</code>指向。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"Objecthis"</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> _dom = <span class="built_in">document</span>.getElementById(<span class="string">'Objecthis'</span>);</span></span><br><span class="line"><span class="actionscript">_dom.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span><span class="params">(e)</span></span>&#123;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">console</span>.log(<span class="keyword">this</span>); <span class="comment">// &lt;div id="Objecthis"&gt;...&lt;/div&gt;</span></span></span><br><span class="line"><span class="undefined">&#125;); </span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h5 id="html里的this"><a href="#html里的this" class="headerlink" title="html里的this"></a>html里的this</h5><p>此时<code>this</code>指向<code>dom</code>本身<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h5</span> <span class="attr">id</span>=<span class="string">"html里的this"</span> <span class="attr">onclick</span>=<span class="string">"console.log(this,typeof this)"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#html里的this"</span> <span class="attr">class</span>=<span class="string">"headerlink"</span> <span class="attr">title</span>=<span class="string">"html里的this"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>html里的this<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br></pre></td></tr></table></figure><br>我们在html里添加一个点击事件，并在点击事件中打印出<code>this</code>，此时我么可以看到console打印台里出现的是这个dom本身，注意这里this打印出来的不是字符串，而是一个dom对象。<br><img src="https://aszero.oss-cn-shanghai.aliyuncs.com/aszero/this-g.jpg" width="100%"></p>
<p>如果把这点击事件提取出来封装成一个方法，点击事件时候调用这个方法，那么此时的this指向的是…<code>windows</code>,因为很显然上面提到了普通调用function的时候this都会指向全局<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h5</span> <span class="attr">id</span>=<span class="string">"html里的this"</span> <span class="attr">onclick</span>=<span class="string">"dosomething();"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#html里的this"</span> <span class="attr">class</span>=<span class="string">"headerlink"</span> <span class="attr">title</span>=<span class="string">"html里的this"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>html里的this<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">doSomething</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="keyword">this</span>);&#125; <span class="comment">//Window &#123;postMessage: ƒ, blur: ƒ, focus: ƒ, close: ƒ, frames: Window, …&#125;</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>原创内容，欢迎交流转载请注明出处</p>
</blockquote>
</div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>theo</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="/posts/64d676f8/">https://joacycode.github.io/posts/64d676f8/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>theoCheung@China</li></ul></div><br><div class="tags"><a href="/tags/this/">this</a></div><div class="post-nav"><a class="pre" href="/posts/7b756efa/">node笔记整理之fs和path</a><a class="next" href="/posts/a055a843/">mac转windows入职舒适体验手册</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget widget-info"><div class="widget-info"><a style="text-align:center"><img class="widget-info-photo" src="https://aszero.oss-cn-shanghai.aliyuncs.com/imgs/fangao_495x606.jpg" style="width:80px;height:80px;border-radius: 100%;"></a><p class="myname">SioCheung</p><p class="slogan">Zero to Hero</p></div></div><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/posts/a0e43f83/">DSL介绍和使用</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/15ddfa03/">你不知道的AST</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/97b701ae/">你不知道的babel</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/e87e7952/">那一年前端招人的部分笔试题</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/6b76c6f6/">shell编程来实现一些自动化-基础篇</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/e7485c24/">常见模块化规范研究记录</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/7b16fe01/">你不知道的rollup</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/ad3abf2b/">浏览器标签之间的通信</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/30ba4d06/">你不知道的yarn</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/5ece973c/">我对于同步异步和阻塞非阻塞理解</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/categories/">categories</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/dotjs/">dotjs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/h5/">h5</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/node/">node</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/shell/">shell</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tool/">tool</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ts/">ts</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/">vue</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/webpack/">webpack</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/windows/">windows</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具/">工具</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/joacycode" title="github.com/joacycode" target="_blank">github.com/joacycode</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2021 <a href="/." rel="nofollow">SioCheung.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>